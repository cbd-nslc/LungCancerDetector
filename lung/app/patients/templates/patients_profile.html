{% extends "base_site.html" %}

{% block title %} Profile {% endblock title %}

{% block stylesheets %}
  {{ super() }}
{% endblock stylesheets %}

{% block content %}
  <div class="right_col" role="main">
    <div class="">
      <div class="page-title">
        <div class="title_left">
          <h1>Patient Profile</h1>
        </div>
      </div>

      <div class="clearfix"></div>


      <div class="row">
        <div class="col-md-12 col-sm-12 col-xs-12">
          <div class="x_panel">

            <!-- x-title -->
            <div class="x_title">
              <h3>Overview</h3>
            </div>

            <div class="x_content">
              <div class="col-md-3 col-sm-3 col-xs-12 profile_left">
                <div class="profile_img">
                  <div id="crop-avatar">
                    <!-- Current avatar -->
                    <img class="img-responsive avatar-view" src="{{ picture_file }}" alt="Avatar" title="Change the avatar" style="width:60%; height:60%">
                  </div>
                </div>
                <h3>{{ patient.first_name }} {{patient.last_name}}</h3>


                <ul class="list-unstyled user_data">
                  <li><i class="fa fa-venus-mars"></i>&nbsp; {{ patient.sex }} &emsp;&emsp;&emsp;&emsp;&emsp;
                    {{ patient.age }} years old
                  </li>

                  <li><i class="fa fa-briefcase user-profile-icon"></i>&nbsp; {{ patient.occupation }}
                  </li>

                  <li><i class="fa fa-map-marker user-profile-icon"></i>&nbsp;  {{ patient.address }}
                  </li>

                </ul>
                <br>

                <a href="{{ url_for('patients_blueprint.edit_info', patient_id=patient.id) }}" class="btn btn-success" style="padding: 10px 20px;"><i class="fa fa-edit m-right-xs"></i>&nbsp;Edit Info</a>

                <br />

                <!-- start skills -->
                
                <!-- end of skills -->
              </div>


              <div class="col-md-9 col-sm-9 col-xs-12">
                <div class="profile_title">
                  <div class="col-md-12">
                    <h2>Patient Medical Status</h2>
                  </div>
                </div>
                
                <!-- tab header -->
                <div class="" role="tabpanel" data-example-id="togglable-tabs">
                  <ul id="myTab" class="nav nav-tabs bar_tabs" role="tablist">

                    <li role="presentation" class="active"><a href="#tab_content1" id="home-tab" role="tab" data-toggle="tab" aria-expanded="true">Health Info (details)</a>
                    </li>
                    <li role="presentation" class=""><a href="#tab_content2" role="tab" id="profile-tab" data-toggle="tab" aria-expanded="false">Upload CT Scan</a>
                    </li>
                    <li role="presentation" class=""><a href="#tab_content3" role="tab" id="profile-tab2" data-toggle="tab" aria-expanded="false">Cancer Report</a>
                    </li>
                  </ul>

                  <!-- tab content -->
                  <div id="myTabContent" class="tab-content">
                    <div role="tabpanel" class="tab-pane fade active in" id="tab_content1" aria-labelledby="home-tab">
                      <!-- start health info -->
                      {% for field in form if field.name in ['weight', 'height', 'blood_pressure', 'diabetes', 'health_condition', 'cancer_report', other_problems] %}
                        <div class="item-form-group">
                          <div class="col-md-3">
                            <label class="control-label">{{ field.label.text }}:
                            </label>
                          </div>
                          <div class="col-md-9">
                              <p>{{ patient[field.name] }}</p>
                          </div>
                        </div>
                        <br><br>

                      {% endfor %}
                      <!-- end health info -->
                    </div>

                    <!-- CT Scan -->
                    <div role="tabpanel" class="tab-pane fade" id="tab_content2" aria-labelledby="profile-tab">
                      {% if patient.ctscan %}
                        <p style="font-size: 25px;">View or change the CT Scan</p><br><br>
                        <div class="col-md-12">
                          <a href="{{ url_for('base_blueprint.result', mhd_md5=patient.ctscan.mhd_md5, patient_id=patient.id) }}" class="btn btn-success" style="padding: 10px 20px; margin-right: 10px;"><i class="fas fa-x-ray"></i>&nbsp;View</a>

                          <a href="{{ url_for('base_blueprint.upload', patient_id=patient.id) }}" class="btn btn-info" style="padding: 10px 20px;"><i class="fa fa-edit m-right-xs" ></i>&nbsp;Reupload</a>
                        </div>

                      {% else %}
                        <p style="font-size: 20px;">You have not uploaded a CT Scan for patient {{ patient.first_name}} {{ patient.last_name }}</p><br><br>
                        <a href="{{ url_for('base_blueprint.upload', patient_id=patient.id) }}" class="btn btn-success"style="padding: 10px 20px;"><i class="fa fa-edit m-right-xs"></i>&nbsp;Upload</a>
                      {% endif %}

                    </div>

                    <div role="tabpanel" class="tab-pane fade" id="tab_content3" aria-labelledby="profile-tab">
                      {% if patient.ctscan %}
                        {% if patient.ctscan.diameter <= 20 %}
                          <p style="font-size: 20px;">Patient "{{ patient.first_name }} {{ patient.last_name }}" was detected having Lung cancer with stage I</p>
                        {% else %}
                          <p style="font-size: 20px;">Patient "{{ patient.first_name }} {{ patient.last_name }}" was detected having Lung cancer with stage II</p>
                        {% endif %}
                        <p style="font-size: 20px;">The size of tumor is {{ patient.ctscan.diameter }} mm in diameter</p>

                        <br><br>
                        <p style="font-size: 15px;">Uploaded {{ patient.ctscan.date_uploaded.strftime('%d-%m-%Y') }}</p>

                      {% else %}
                        <p style="font-size: 20px;">Patient "{{ patient.first_name }} {{ patient.last_name }}" has no cancer report</p>
                      {% endif %}

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}

{% block javascripts %}
  {{ super() }}
  <!-- morris.js -->
  <script src="{{ url_for('static', filename='vendors/raphael/raphael.min.js') }}"></script>
  <script src="{{ url_for('static', filename='vendors/morris.js/morris.min.js') }}"></script>
{% endblock javascripts %}