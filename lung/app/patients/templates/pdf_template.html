<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <link href="{{ url_for('static', filename='css/pdf.css') }}", media="print", rel="stylesheet">
  </head>

  <body>
    <h1>CANCER REPORT</h1>

    <dl>
      <dt>Upload date</dt>
      <dd>{{ upload.date_uploaded.strftime("%B %d, %Y - %H:%M") }}</dd>
    </dl>

    <!-- Personal info -->
    <h2 style="margin-top: 3em;">Personal information</h2>

    <div id="personal-info">
      <div class="outer-row">
        {% for field in ['first_name', 'last_name'] %}
          <div class="column">
            <div class="inner-row">
              <div class="label">{{ form[field].label.text }}:</div>
              <div class="content">{{ upload.patient[field] }}</div>
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="outer-row">
        {% for field in ['age', 'sex'] %}
          <div class="column">
            <div class="inner-row">
              <div class="label">{{ form[field].label.text }}:</div>
              <div class="content">{{ upload.patient[field] }}</div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <div id="address">
      {% for field in ['occupation', 'address'] %}
        <div class="outer-row">
          <div class="column">
            <div class="inner-row">
              <div class="label">{{ form[field].label.text }}:</div>
              <div class="content">{{ upload.patient[field] }}</div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- health info -->
    <h2>Health information</h2>

    <div id="health-info">
      <div class="outer-row">
        <div class="column">
          <!-- basic health -->
          <h4>Health</h4>
          {% for field in health_info_dict['health'] %}
            <div class="inner-row">
              <div class="label">{{ form[field].label.text }}:</div>
              <div class="content">{{ upload.patient[field] }}</div>
            </div>
          {% endfor %}<br>

          <h4>General Biochemistry</h4>
          {% for field in health_info_dict['general_biochemistry'] %}
            <div class="inner-row">
              <div class="label">{{ form[field].label.text }}:</div>
              <div class="content">{{ upload.patient[field] }}</div>
            </div>
          {% endfor %}<br>

          <h4>Comorbidities</h4>
          {% for field in health_info_dict['comorbidities'] %}
            <div class="inner-row">
              <div class="label">{{ form[field].label.text }}:</div>
              <div class="content">{{ upload.patient[field] }}</div>
            </div>
          {% endfor %}<br>
        </div>


        <div class="column">
          <h4>Genetic Test </h4>
          {% for field in health_info_dict['genetic_test'] %}
            <div class="inner-row">
              <div class="label">{{ form[field].label.text }}:</div>
              <div class="content">{{ upload.patient[field] }}</div>
            </div>
          {% endfor %}<br>

          <h4>Serum Tumor Markers</h4>
          {% for field in health_info_dict['serum_tumor_markers'] %}
            <div class="inner-row">
              <div class="label">{{ form[field].label.text }}:</div>
              <div class="content">{{ upload.patient[field] }}</div>
            </div>
          {% endfor %}<br>
        </div>

        <div class="column">
          <h4>Biopsy Test</h4>
          {% for field in health_info_dict['biopsy_test'] %}
            <div class="inner-row">
              <div class="label">{{ form[field].label.text }}:</div>
              <div class="content">{{ upload.patient[field] }}</div>
            </div>
          {% endfor %}<br>

          <h4>Biochemistry Realization</h4>
          {% for field in health_info_dict['biochemistry_realization'] %}
            <div class="inner-row">
              <div class="label" style="flex: 1.5!important;">{{ form[field].label.text }}:</div>
              <div class="content">{{ upload.patient[field] }}</div>
            </div>
          {% endfor %}<br>
        </div>
      </div>
    </div>

    <!-- OUTCOME -->
    <h2 style="color:#654321;">Outcome</h2>

    <div id="outcome">
      <!-- conclusion -->
      <h3>Conclusion</h3>
      <div class="outer-row">
        <div class="column">
          <!-- no lung cancer -->
          {% if result_percent == 0 %}
            <p>PATIENT DOES NOT HAVE LUNG CANCER</p>
          <!-- have lung cancer -->
          {% elif result_percent == 1 %}
            <p>PATIENT WAS DETECTED HAVING LUNG CANCER {{ result_text }}</p>

          <!-- not sure -->
          {% else %}
            <p>PATIENT HAS {{ (result_percent * 100) | round(2) }}% CHANCE OF HAVING CANCER</p>
          {% endif %}
        </div>
      </div><br>

      <!-- Visualization -->
      <h3>Visualization</h3>
      <div class="outer-row">
        <div class="label">
          <img src="{{ url_for('static', filename='uploaded_ct_scan/' + upload.ct_scan.bbox_basename) }}">
        </div>

        <div class="content">
          <div>The size of tumor is {{ ct_scan.diameter }} mm in diameter</div>
        </div>

      </div><br><br>

      <!-- TREATMENT  -->
      <h3>Treatment recommendation</h3>
      <div class="outer-row">
        <div class="column">
          <!-- have lung cancer -->
          {% if result_percent == 1 %}
            <!-- stage 1 -->
            {% if ct_scan.diameter <= 20 %}
              <p>If you have stage I NSCLC, surgery may be the only treatment you need. This may be done either by taking out the lobe of the lung that has the tumor (lobectomy) or by taking out a smaller piece of the lung (sleeve resection, segmentectomy, or wedge resection). At least some lymph nodes in the lung and in the space between the lungs will also be removed and checked for cancer.</p>
              <p>Segmentectomy or wedge resection is generally an option only for very small stage I cancers and for patients with other health problems that make removing the entire lobe dangerous. Still, most surgeons believe it is better to do a lobectomy if the patient can tolerate it, as it offers the best chance for cure.</p>
              <p>After surgery, the removed tissue is checked to see if there are cancer cells at the edges of the surgery specimen (called positive margins). This could mean that some cancer has been left behind, so a second surgery might be done to try to ensure that all the cancer has been removed. (This might be followed by chemotherapy as well.) Another option might be to use radiation therapy after surgery.</p>
              <p>If you have serious health problems that prevent you from having surgery, you may get stereotactic body radiation therapy (SBRT) or another type of radiation therapy as your main treatment. Radiofrequency ablation (RFA) may be another option if the tumor is small and in the outer part of the lung.</p>
            <!-- stage 2 -->
            {% else %}
              <p>People who have stage II NSCLC and are healthy enough for surgery usually have the cancer removed by lobectomy or sleeve resection. Sometimes removing the whole lung (pneumonectomy) is needed.</p>
              <p>Any lymph nodes likely to have cancer in them are also removed. The extent of lymph node involvement and whether or not cancer cells are found at the edges of the removed tissues are important factors when planning the next step of treatment.</p>
              <p>After surgery, the removed tissue is checked to see if there are cancer cells at the edges of the surgery specimen. This might mean that some cancer has been left behind, so a second surgery might be done to try to remove any remaining cancer. This may be followed by chemotherapy (chemo). Another option is to treat with radiation, sometimes with chemo.</p>
              <p>Even if positive margins are not found, chemo is usually recommended after surgery to try to destroy any cancer cells that might have been left behind. As with stage I cancers, newer lab tests now being studied may help doctors find out which patients need this adjuvant treatment and which are less likely to benefit from it.</p>
              <p>If you have serious medical problems that would keep you from having surgery, you may get only radiation therapy as your main treatment.</p>
            {% endif %}

          <!-- no lung cancer & not sure -->
          {% else %}
            <p>No treatment required</p>
          {% endif %}
        </div>
      </div><br><br>

      <!-- MEDICINE -->
      <h3>Medicine recommendation</h3>
      <div class="outer-row">
        <div class="column">
          {% if result_percent == 1 %}
            <p style="text-decoration: underline; margin-bottom:0.5rem!important;">CYRAMZA + ERLOTINIB</p>
            <p>The trial was designed to measure disease progression, which is the time that people lived without their cancer spreading or growing after taking treatment. The study also measured the proportion of patients who had a reduction in tumor size of 30% or more</p>
            <p>CYRAMZA + erlotinib was studied in a clinical trial for the initial treatment of people with metastatic NSCLC with certain EGFR mutations. Of the 449 people included in the trial, 224 people received CYRAMZA + erlotinib and 225 people received placebo + erlotinib.</p>
            <p>In a clinical study, CYRAMZA + erlotinib provided more time without disease progression than placebo + erlotinib for people with metastatic NSCLC with certain types of EGFR mutations. On average, people taking CYRAMZA + erlotinib lived 19 months without disease progression compared with 12 months for those taking placebo + erlotinib</p><br>

            <p style="text-decoration: underline; margin-bottom:0.5rem!important;">CYRAMZA + DOCETAXEL </p>
            <p>36% of people had delayed disease progression for 6 months or longer with CYRAMZA + docetaxeI (a type of chemotherapy) vs 29% with chemotherapy alone
              Half of the people who received CYRAMZA + chemotherapy lived without their cancer getting worse for 4.5 months vs 3.0 months with chemotherapy alone</p>
            <p>43% of people lived 1 year or longer with CYRAMZA + chemotherapy vs 38% with chemotherapy alone
              Half of the people who received CYRAMZA + chemotherapy after their cancer progressed were still alive at 10.5 months vs 9.1 months with chemotherapy alone.</p>
            <p>CYRAMZA was studied in a clinical trial of 1253 people with metastatic non-small cell lung cancer who received CYRAMZA + docetaxel (628 people) vs those who received docetaxel alone (625 people). All people in the study had previously received platinum-containing chemotherapy.</p>

          {% else %}
            <p>No medicine required</p>
          {% endif %}
        </div>
      </div><br><br>
    </div>

    <!-- PREVIOUS UPLOADS -->
    <h2 style="page-break-before: always;">Previous uploads</h2>

    <div id="table" style="clear: both; page-break-after: always;">
      <table>
        <thead>
          <th>#</th>
          <th>Status</th>
          <th>Diameter</th>
          <th>Upload date</th>
        </thead>

        <tbody>
          {% if previous_upload_list | length > 0 %}
            {% for previous_upload in previous_upload_list %}
              <tr>
                <td>{{ loop.index }}</td>

                <!-- status -->
                <td>
                  {{ previous_upload.result_text }}
                </td>

                <!-- diameter -->
                <td>{{ previous_upload.ct_scan.diameter }} mm</td>

                <!-- date uploaded -->
                <td>{{ previous_upload.date_uploaded.strftime("%B %d, %Y - %H:%M") }}</td>
              </tr>

            {% endfor %}
          {% else %}
            <tr>
              <td colspan="4"><div style="text-align: center">No previous reports</div></td>
            </tr>
          {% endif %}

        </tbody>
      </table>
    </div>

  </body>


</html>



